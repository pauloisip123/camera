<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10-Digit Numeric Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --primary: #059669; --error: #dc2626; --bg: #f3f4f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        .container { width: 100%; max-width: 450px; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        #reader { width: 100%; border-radius: 12px; overflow: hidden; background: #000; margin-bottom: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { font-size: 0.7em; background: #ecfdf5; color: #065f46; padding: 4px 10px; border-radius: 20px; border: 1px solid #a7f3d0; }
        
        .table-wrapper { max-height: 250px; overflow-y: auto; margin-top: 15px; border: 1px solid #e5e7eb; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        th { background: #f9fafb; color: #6b7280; position: sticky; top: 0; padding: 10px; text-align: left; }
        td { padding: 12px 10px; border-top: 1px solid #f3f4f6; }

        .btn-clear { background: none; color: #9ca3af; border: 1px solid #e5e7eb; padding: 5px 10px; border-radius: 6px; cursor: pointer; font-size: 0.75em; transition: 0.2s; }
        .btn-clear:hover { background: #fee2e2; color: #ef4444; border-color: #fecaca; }

        #toast { 
            position: fixed; bottom: 30px; background: #1f2937; color: white; padding: 12px 25px; 
            border-radius: 8px; font-size: 0.9em; opacity: 0; transition: 0.3s; z-index: 9999; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div id="toast">Invalid Format</div>

    <div class="container">
        <div class="header">
            <h2 style="margin:0; font-size: 1.2em;">Data Logger</h2>
            <span class="badge">10 DIGITS â€¢ NUMBERS ONLY</span>
        </div>
        
        <div id="reader"></div>

        <div style="display:flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 0.8em; color: #6b7280;">Records: <b id="count" style="color:var(--primary)">0</b></span>
            <button class="btn-clear" onclick="clearData()">Clear All</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Numeric Code</th>
                    </tr>
                </thead>
                <tbody id="scan-list"></tbody>
            </table>
        </div>
    </div>

    <audio id="beep" src="https://www.soundjay.com/buttons/beep-07a.wav" preload="auto"></audio>
    <audio id="error-sound" src="https://www.soundjay.com/buttons/button-10.wav" preload="auto"></audio>

    <script>
        let savedScans = JSON.parse(localStorage.getItem('numericBarcodes')) || [];
        const scanList = document.getElementById('scan-list');
        const countDisplay = document.getElementById('count');
        const beep = document.getElementById('beep');
        const errorSound = document.getElementById('error-sound');
        const toast = document.getElementById('toast');

        function init() {
            renderTable();
            startScanner();
        }

        async function startScanner() {
            const html5QrCode = new Html5Qrcode("reader");
            const config = { fps: 20, qrbox: { width: 250, height: 150 } };

            try {
                await html5QrCode.start(
                    { facingMode: "environment" }, 
                    config, 
                    (decodedText) => {
                        // REGEX: Dapat 10 characters at lahat ay NUMBERS lang
                        const isNumeric = /^\d{10}$/.test(decodedText);

                        if (!isNumeric) {
                            showToast("Error: Hindi 10-digit number!", "var(--error)");
                            errorSound.play();
                            return; 
                        }

                        // DUPLICATE CHECK
                        if (savedScans.some(item => item.content === decodedText)) {
                            showToast("Duplicate ignored", "#374151");
                            return;
                        }

                        saveNewScan(decodedText);
                    }
                );
            } catch (err) {
                console.error(err);
            }
        }

        function saveNewScan(content) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            savedScans.unshift({ time: timeStr, content: content });
            localStorage.setItem('numericBarcodes', JSON.stringify(savedScans));
            
            beep.play();
            if (navigator.vibrate) navigator.vibrate(100);
            renderTable();
        }

        function renderTable() {
            scanList.innerHTML = savedScans.map(item => `
                <tr>
                    <td style="color:#9ca3af">${item.time}</td>
                    <td><strong style="letter-spacing: 1px;">${item.content}</strong></td>
                </tr>
            `).join('');
            countDisplay.innerText = savedScans.length;
        }

        function showToast(msg, color) {
            toast.innerText = msg;
            toast.style.background = color;
            toast.style.opacity = "1";
            setTimeout(() => { toast.style.opacity = "0"; }, 2000);
        }

        function clearData() {
            if(confirm("Burahin ang lahat ng records?")) {
                localStorage.removeItem('numericBarcodes');
                savedScans = [];
                renderTable();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
