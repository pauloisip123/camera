<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2 Column Sync Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { width: 100%; max-width: 400px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; margin-bottom: 15px; background: #000; }
        .status { padding: 10px; border-radius: 8px; font-weight: bold; font-size: 0.9em; margin-bottom: 10px; display: none; }
        .active { display: block; background: #e0f2fe; color: #0369a1; }
        .success { display: block; background: #dcfce7; color: #15803d; }
        .warning { display: block; background: #fef3c7; color: #92400e; }
    </style>
</head>
<body>

    <div class="card">
        <h3 style="margin-top:0;">Column B2 Sync</h3>
        <div id="status" class="status">Initializing...</div>
        <div id="reader"></div>
        <p style="font-size: 0.8em; color: #666;">Target: First empty cell in Column B (10 digits only)</p>
    </div>

    <audio id="beep" src="https://www.soundjay.com/buttons/beep-07a.wav" preload="auto"></audio>

    <script>
        // ILAGAY DITO ANG BAGONG DEPLOYMENT URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxVZ0tDYmaaX0joREm8zsM089lBss_CYjZS5GtxFZYUNafnyANm-gEy4iCKk1Tv6-_g-g/exec';
        
        const statusDiv = document.getElementById('status');
        const beep = document.getElementById('beep');
        let isLocked = false;

        async function startScanner() {
            const html5QrCode = new Html5Qrcode("reader");
            try {
                await html5QrCode.start(
                    { facingMode: "environment" }, 
                    { fps: 15, qrbox: { width: 250, height: 150 } },
                    (decodedText) => {
                        // VALIDATION: 10 Digits at hindi busy ang sync
                        if (/^\d{10}$/.test(decodedText) && !isLocked) {
                            syncToSheets(decodedText);
                        }
                    }
                );
                updateStatus("System Ready", "active");
            } catch (err) { updateStatus("Camera Error", "warning"); }
        }

        async function syncToSheets(code) {
            isLocked = true;
            updateStatus("Checking & Saving: " + code, "active");

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify({ barcode: code })
                });
                
                beep.play();
                updateStatus("Saved to Column B!", "success");
            } catch (e) {
                updateStatus("Sync Failed!", "warning");
            }

            // Cooldown para iwas multiple scan sa iisang tutok
            setTimeout(() => { 
                isLocked = false; 
                updateStatus("Ready for next scan", "active");
            }, 3000);
        }

        function updateStatus(msg, type) {
            statusDiv.innerText = msg;
            statusDiv.className = "status " + type;
        }

        window.onload = startScanner;
    </script>
</body>
</html>






